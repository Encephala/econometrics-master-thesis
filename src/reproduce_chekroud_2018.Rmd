# Reproduce Chekroud

Takes a model and the preprocessed data from the python script and runs the model on the data.

```{r Dependencies}
if (!requireNamespace("lavaan")) {
    install.packages("lavaan")
}
if (!requireNamespace("semPlot")) {
    install.packages("semPlot")
}
if (!requireNamespace("haven")) {
    install.packages("haven")
}

library(lavaan)
library(semPlot)
library(haven)
```

```{r Load data}
all_relevant_data <- read_dta("/tmp/data.dta")
head(all_relevant_data)
```

```{r}
sem_model <- "
mhi ~ cs104 + leeftijd_18_to_24_years + leeftijd_25_to_29_years + leeftijd_30_to_34_years + leeftijd_35_to_39_years + leeftijd_40_to_44_years + leeftijd_45_to_49_years + leeftijd_50_to_54_years + leeftijd_55_to_59_years + leeftijd_60_to_64_years + leeftijd_65_to_69_years + leeftijd_70_to_74_years + leeftijd_75_to_79_years + leeftijd_over_80 + herkomstgroep_first_nonw + herkomstgroep_first_w + herkomstgroep_nan + herkomstgroep_second_nonw + herkomstgroep_second_w + geslacht_male + bmi_nan + bmi_normal_weight + bmi_obese + bmi_overweight + burgstat_married + burgstat_never_been_married + burgstat_separated + burgstat_widow_or_widower + nettohh_f_nan + nettohh_f_over + prev_depr
"
```

```{r}
sem_fit <- sem(sem_model, data = all_relevant_data)

summary(sem_fit, standardized = TRUE, fit.measures = TRUE)
```

```{r}
# Visualize the SEM model
semPaths(sem_fit, what = "std", edge.label.cex = .8, layout = "tree")
```

```{r}
fitMeasures(sem_fit, c("chisq", "df", "pvalue", "cfi", "tli", "rmsea", "srmr", "aic", "bic"))
```

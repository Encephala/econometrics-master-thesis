# Reproduce Chekroud

Takes a model and the preprocessed data from the python script and runs the model on the data.

```{r Dependencies}
if (!requireNamespace("lavaan")) {
    install.packages("lavaan")
}
if (!requireNamespace("semPlot")) {
    install.packages("semPlot")
}
if (!requireNamespace("haven")) {
    install.packages("haven")
}

library(lavaan)
library(semPlot)
library(haven)
```

```{r Load data}
all_relevant_data <- read_dta("/tmp/data.dta")
head(all_relevant_data)
```

```{r}
sem_model <- "
mhi ~ cs104 + leeftijd_over_80 + leeftijd_50_to_54_years + leeftijd_18_to_24_years + leeftijd_60_to_64_years + leeftijd_35_to_39_years + leeftijd_55_to_59_years + leeftijd_70_to_74_years + leeftijd_65_to_69_years + leeftijd_25_to_29_years + leeftijd_40_to_44_years + leeftijd_45_to_49_years + leeftijd_75_to_79_years + leeftijd_30_to_34_years + herkomstgroep_second_nonw + herkomstgroep_second_w + herkomstgroep_nan + herkomstgroep_first_nonw + herkomstgroep_first_w + geslacht_other + geslacht_nan + geslacht_male + burgstat_separated + burgstat_married + burgstat_widow_or_widower + burgstat_never_been_married + nettohh_f_25_to_35000 + nettohh_f_35_to_50000 + nettohh_f_15_to_25000 + nettohh_f_nan + nettohh_f_over_50000 + oplcat_wo + oplcat_hbo + oplcat_primary_school + oplcat_vmbo + oplcat_mbo + oplcat_nan + employment_self_employed + employment_retired + employment_homemaker + employment_out_of_work + employment_unable_to_work + employment_student + ch4_good + ch4_poor + ch4_moderate + ch4_very_good + bmi_overweight + bmi_normal_weight + bmi_nan + bmi_obese + prev_depr
"
```

```{r}
sem_fit <- sem(sem_model, data = all_relevant_data)

summary(sem_fit, standardized = TRUE, fit.measures = TRUE)
```

```{r}
# Visualize the SEM model
semPaths(sem_fit, what = "std", edge.label.cex = .8, layout = "tree")
```

```{r}
fitMeasures(sem_fit, c("chisq", "df", "pvalue", "cfi", "tli", "rmsea", "srmr", "aic", "bic"))
```

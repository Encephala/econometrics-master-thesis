# Reproduce Chekroud

Takes a model and the preprocessed data from the python script and runs the model on the data.

```{r Dependencies}
if (!requireNamespace("lavaan")) {
    install.packages("lavaan")
}
if (!requireNamespace("haven")) {
    install.packages("haven")
}

library(lavaan)
library(haven)
```

```{r Load data}
all_relevant_data <- read_dta("/tmp/data.dta")
head(all_relevant_data)
```

```{r}
sem_model <- "
# Regressions (structural part)
mhi5 ~ cs104 + ch4_good + ch4_moderate + ch4_poor + ch4_very_good + leeftijd_18_24 + leeftijd_25_39 + leeftijd_40_66 + leeftijd_over_67 + herkomstgroep_first_w + herkomstgroep_first_nonw + herkomstgroep_second_w + herkomstgroep_second_nonw + geslacht_male + geslacht_other + bmi_normal_weight + bmi_overweight + bmi_obese + burgstat_married + burgstat_never_been_married + burgstat_separated + burgstat_widow_or_widower + nettohh_f_under_15k + nettohh_f_15k_50k + nettohh_f_over_50k + oplcat_hbo + oplcat_mbo + oplcat_primary_school + oplcat_vmbo + oplcat_wo + employment_homemaker + employment_retired + employment_student + employment_unable_to_work + employment_unemployed + prev_depr
ch4_good ~ cs104 + leeftijd_18_24 + leeftijd_25_39 + leeftijd_40_66 + leeftijd_over_67 + herkomstgroep_first_w + herkomstgroep_first_nonw + herkomstgroep_second_w + herkomstgroep_second_nonw + geslacht_male + geslacht_other + bmi_normal_weight + bmi_overweight + bmi_obese + burgstat_married + burgstat_never_been_married + burgstat_separated + burgstat_widow_or_widower + nettohh_f_under_15k + nettohh_f_15k_50k + nettohh_f_over_50k + oplcat_hbo + oplcat_mbo + oplcat_primary_school + oplcat_vmbo + oplcat_wo + employment_homemaker + employment_retired + employment_student + employment_unable_to_work + employment_unemployed + prev_depr
ch4_moderate ~ cs104 + leeftijd_18_24 + leeftijd_25_39 + leeftijd_40_66 + leeftijd_over_67 + herkomstgroep_first_w + herkomstgroep_first_nonw + herkomstgroep_second_w + herkomstgroep_second_nonw + geslacht_male + geslacht_other + bmi_normal_weight + bmi_overweight + bmi_obese + burgstat_married + burgstat_never_been_married + burgstat_separated + burgstat_widow_or_widower + nettohh_f_under_15k + nettohh_f_15k_50k + nettohh_f_over_50k + oplcat_hbo + oplcat_mbo + oplcat_primary_school + oplcat_vmbo + oplcat_wo + employment_homemaker + employment_retired + employment_student + employment_unable_to_work + employment_unemployed + prev_depr
ch4_poor ~ cs104 + leeftijd_18_24 + leeftijd_25_39 + leeftijd_40_66 + leeftijd_over_67 + herkomstgroep_first_w + herkomstgroep_first_nonw + herkomstgroep_second_w + herkomstgroep_second_nonw + geslacht_male + geslacht_other + bmi_normal_weight + bmi_overweight + bmi_obese + burgstat_married + burgstat_never_been_married + burgstat_separated + burgstat_widow_or_widower + nettohh_f_under_15k + nettohh_f_15k_50k + nettohh_f_over_50k + oplcat_hbo + oplcat_mbo + oplcat_primary_school + oplcat_vmbo + oplcat_wo + employment_homemaker + employment_retired + employment_student + employment_unable_to_work + employment_unemployed + prev_depr
ch4_very_good ~ cs104 + leeftijd_18_24 + leeftijd_25_39 + leeftijd_40_66 + leeftijd_over_67 + herkomstgroep_first_w + herkomstgroep_first_nonw + herkomstgroep_second_w + herkomstgroep_second_nonw + geslacht_male + geslacht_other + bmi_normal_weight + bmi_overweight + bmi_obese + burgstat_married + burgstat_never_been_married + burgstat_separated + burgstat_widow_or_widower + nettohh_f_under_15k + nettohh_f_15k_50k + nettohh_f_over_50k + oplcat_hbo + oplcat_mbo + oplcat_primary_school + oplcat_vmbo + oplcat_wo + employment_homemaker + employment_retired + employment_student + employment_unable_to_work + employment_unemployed + prev_depr

# Additional covariances
ch4_good ~~ ch4_moderate + ch4_poor + ch4_very_good
ch4_moderate ~~ ch4_poor + ch4_very_good
ch4_poor ~~ ch4_very_good
leeftijd_18_24 ~~ leeftijd_25_39 + leeftijd_40_66 + leeftijd_over_67
leeftijd_25_39 ~~ leeftijd_40_66 + leeftijd_over_67
leeftijd_40_66 ~~ leeftijd_over_67
herkomstgroep_first_w ~~ herkomstgroep_first_nonw + herkomstgroep_second_w + herkomstgroep_second_nonw
herkomstgroep_first_nonw ~~ herkomstgroep_second_w + herkomstgroep_second_nonw
herkomstgroep_second_w ~~ herkomstgroep_second_nonw
geslacht_male ~~ geslacht_other
bmi_normal_weight ~~ bmi_overweight + bmi_obese
bmi_overweight ~~ bmi_obese
burgstat_married ~~ burgstat_never_been_married + burgstat_separated + burgstat_widow_or_widower
burgstat_never_been_married ~~ burgstat_separated + burgstat_widow_or_widower
burgstat_separated ~~ burgstat_widow_or_widower
nettohh_f_under_15k ~~ nettohh_f_15k_50k + nettohh_f_over_50k
nettohh_f_15k_50k ~~ nettohh_f_over_50k
oplcat_hbo ~~ oplcat_mbo + oplcat_primary_school + oplcat_vmbo + oplcat_wo
oplcat_mbo ~~ oplcat_primary_school + oplcat_vmbo + oplcat_wo
oplcat_primary_school ~~ oplcat_vmbo + oplcat_wo
oplcat_vmbo ~~ oplcat_wo
employment_homemaker ~~ employment_retired + employment_student + employment_unable_to_work + employment_unemployed
employment_retired ~~ employment_student + employment_unable_to_work + employment_unemployed
employment_student ~~ employment_unable_to_work + employment_unemployed
employment_unable_to_work ~~ employment_unemployed

"
```

```{r}
sem_fit <- sem(sem_model, data = all_relevant_data)

summary(sem_fit, fit.measures = TRUE)
```

```{r}
# Potential model improvements
modindices(sem_fit)
```

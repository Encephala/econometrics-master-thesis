# Reproduce Chekroud

Takes a model and the preprocessed data from the python script and runs the model on the data.

```{r Dependencies}
if (!requireNamespace("lavaan")) {
    install.packages("lavaan")
}
if (!requireNamespace("haven")) {
    install.packages("haven")
}

library(lavaan)
library(haven)
```

```{r Load data}
all_relevant_data <- read_dta("/tmp/panel_data.dta")
head(all_relevant_data)

options(max.print = 2500)
```

```{r}
sem_model <- "
# Regressions (structural part)
mhi5_12 ~ alpha_mhi5_t12*1 + beta0_cs104*cs104_12 + delta0_leeftijd_18_24*leeftijd_12_18_24 + delta0_leeftijd_25_39*leeftijd_12_25_39 + delta0_leeftijd_40_66*leeftijd_12_40_66 + delta0_leeftijd_over_67*leeftijd_12_over_67
mhi5_13 ~ alpha_mhi5_t13*1 + beta0_cs104*cs104_13 + delta0_leeftijd_18_24*leeftijd_13_18_24 + delta0_leeftijd_25_39*leeftijd_13_25_39 + delta0_leeftijd_40_66*leeftijd_13_40_66 + delta0_leeftijd_over_67*leeftijd_13_over_67
mhi5_15 ~ alpha_mhi5_t15*1 + beta0_cs104*cs104_15 + delta0_leeftijd_18_24*leeftijd_15_18_24 + delta0_leeftijd_25_39*leeftijd_15_25_39 + delta0_leeftijd_40_66*leeftijd_15_40_66 + delta0_leeftijd_over_67*leeftijd_15_over_67
mhi5_16 ~ alpha_mhi5_t16*1 + beta0_cs104*cs104_16 + delta0_leeftijd_18_24*leeftijd_16_18_24 + delta0_leeftijd_25_39*leeftijd_16_25_39 + delta0_leeftijd_40_66*leeftijd_16_40_66 + delta0_leeftijd_over_67*leeftijd_16_over_67
mhi5_17 ~ alpha_mhi5_t17*1 + beta0_cs104*cs104_17 + delta0_leeftijd_18_24*leeftijd_17_18_24 + delta0_leeftijd_25_39*leeftijd_17_25_39 + delta0_leeftijd_40_66*leeftijd_17_40_66 + delta0_leeftijd_over_67*leeftijd_17_over_67
mhi5_18 ~ alpha_mhi5_t18*1 + beta0_cs104*cs104_18 + delta0_leeftijd_18_24*leeftijd_18_18_24 + delta0_leeftijd_25_39*leeftijd_18_25_39 + delta0_leeftijd_40_66*leeftijd_18_40_66 + delta0_leeftijd_over_67*leeftijd_18_over_67
mhi5_19 ~ alpha_mhi5_t19*1 + beta0_cs104*cs104_19 + delta0_leeftijd_18_24*leeftijd_19_18_24 + delta0_leeftijd_25_39*leeftijd_19_25_39 + delta0_leeftijd_40_66*leeftijd_19_40_66 + delta0_leeftijd_over_67*leeftijd_19_over_67
mhi5_20 ~ alpha_mhi5_t20*1 + beta0_cs104*cs104_20 + delta0_leeftijd_18_24*leeftijd_20_18_24 + delta0_leeftijd_25_39*leeftijd_20_25_39 + delta0_leeftijd_40_66*leeftijd_20_40_66 + delta0_leeftijd_over_67*leeftijd_20_over_67
mhi5_21 ~ alpha_mhi5_t21*1 + beta0_cs104*cs104_21 + delta0_leeftijd_18_24*leeftijd_21_18_24 + delta0_leeftijd_25_39*leeftijd_21_25_39 + delta0_leeftijd_40_66*leeftijd_21_40_66 + delta0_leeftijd_over_67*leeftijd_21_over_67
mhi5_22 ~ alpha_mhi5_t22*1 + beta0_cs104*cs104_22 + delta0_leeftijd_18_24*leeftijd_22_18_24 + delta0_leeftijd_25_39*leeftijd_22_25_39 + delta0_leeftijd_40_66*leeftijd_22_40_66 + delta0_leeftijd_over_67*leeftijd_22_over_67
mhi5_23 ~ alpha_mhi5_t23*1 + beta0_cs104*cs104_23 + delta0_leeftijd_18_24*leeftijd_23_18_24 + delta0_leeftijd_25_39*leeftijd_23_25_39 + delta0_leeftijd_40_66*leeftijd_23_40_66 + delta0_leeftijd_over_67*leeftijd_23_over_67

# Total effect


# Additional covariances
mhi5_12 ~~ gamma1_y_x*cs104_13 + gamma3_y_x*cs104_15 + gamma4_y_x*cs104_16 + gamma5_y_x*cs104_17 + gamma6_y_x*cs104_18 + gamma7_y_x*cs104_19 + gamma8_y_x*cs104_20 + gamma9_y_x*cs104_21 + gamma10_y_x*cs104_22 + gamma11_y_x*cs104_23
mhi5_13 ~~ gamma2_y_x*cs104_15 + gamma3_y_x*cs104_16 + gamma4_y_x*cs104_17 + gamma5_y_x*cs104_18 + gamma6_y_x*cs104_19 + gamma7_y_x*cs104_20 + gamma8_y_x*cs104_21 + gamma9_y_x*cs104_22 + gamma10_y_x*cs104_23
mhi5_15 ~~ gamma1_y_x*cs104_16 + gamma2_y_x*cs104_17 + gamma3_y_x*cs104_18 + gamma4_y_x*cs104_19 + gamma5_y_x*cs104_20 + gamma6_y_x*cs104_21 + gamma7_y_x*cs104_22 + gamma8_y_x*cs104_23
mhi5_16 ~~ gamma1_y_x*cs104_17 + gamma2_y_x*cs104_18 + gamma3_y_x*cs104_19 + gamma4_y_x*cs104_20 + gamma5_y_x*cs104_21 + gamma6_y_x*cs104_22 + gamma7_y_x*cs104_23
mhi5_17 ~~ gamma1_y_x*cs104_18 + gamma2_y_x*cs104_19 + gamma3_y_x*cs104_20 + gamma4_y_x*cs104_21 + gamma5_y_x*cs104_22 + gamma6_y_x*cs104_23
mhi5_18 ~~ gamma1_y_x*cs104_19 + gamma2_y_x*cs104_20 + gamma3_y_x*cs104_21 + gamma4_y_x*cs104_22 + gamma5_y_x*cs104_23
mhi5_19 ~~ gamma1_y_x*cs104_20 + gamma2_y_x*cs104_21 + gamma3_y_x*cs104_22 + gamma4_y_x*cs104_23
mhi5_20 ~~ gamma1_y_x*cs104_21 + gamma2_y_x*cs104_22 + gamma3_y_x*cs104_23
mhi5_21 ~~ gamma1_y_x*cs104_22 + gamma2_y_x*cs104_23
mhi5_22 ~~ gamma1_y_x*cs104_23

# Operations/constraints


"
```

```{r}
sem_fit <- sem(sem_model, data = all_relevant_data)

summary(sem_fit, fit.measures = TRUE)
```

```{r}
# Potential model improvements
modindices(sem_fit)
```
